Script started on 2023-04-30 18:16:01-0400
ls]0;racecar@racecar: ~/racecar_ws/src/final_race[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race[00m$ ls[K[Kcd scripts/
]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ ls
[0m[01;34mcomputer_vision[0m   [01;32mcone_sim_marker.py[0m         [01;32mline_detector.py[0m           [01;32mparking_controller.py[0m
[01;32mcone_detector.py[0m  [01;32mhomography_transformer.py[0m  [01;32mparking_controller_old.py[0m  [01;34mrace_rosbags[0m
]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ cd [K[K[Kvim[K[K[Kvim parking_controller
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller" [New File][2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[2;1H[94m~                                                                                                                       [3;1H~                                                                                                                       [4;1H~                                                                                                                       [5;1H~                                                                                                                       [6;1H~                                                                                                                       [7;1H~                                                                                                                       [8;1H~                                                                                                                       [9;1H~                                                                                                                       [10;1H~                                                                                                                       [11;1H~                                                                                                                       [12;1H~                                                                                                                       [13;1H~                                                                                                                       [14;1H~                                                                                                                       [15;1H~                                                                                                                       [16;1H~                                                                                                                       [17;1H~                                                                                                                       [18;1H~                                                                                                                       [19;1H~                                                                                                                       [20;1H~                                                                                                                       [21;1H~                                                                                                                       [22;1H~                                                                                                                       [23;1H~                                                                                                                       [24;1H~                                                                                                                       [25;1H~                                                                                                                       [26;1H~                                                                                                                       [27;1H~                                                                                                                       [28;1H~                                                                                                                       [29;1H~                                                                                                                       [m[30;103H0,0-1[9CAll[1;1H[?25h[?12$p[?25l[30;93H:[1;1H[30;1H[K[30;1H:[?2004h[?25hq[?25l[?25h[?25l[?2004l[30;1H[K[30;1H[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ vim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3784C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;1H[35mfrom[m final_race.msg [35mimport[m ConeLocation, ParkingError
[35mfrom[m ackermann_msgs.msg [35mimport[m AckermannDriveStamped, AckermannDrive

[38;5;130mclass[m [36mParkingController[m():
    [31m"""
    A controller for parking in front of a cone.
    Listens for a relative cone location and publishes control commands.
    Can be used in the simulator and on the real robot.
    """[m
    CIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[12;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[13;13Hself.relative_cone_callback)[15;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [16;1Hdifferent for simulator vs racecar[m[17;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[18;13HAckermannDriveStamped, queue_size=[31m10[m)[19;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[20;13HParkingError, queue_size=[31m10[m)[22;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[23;9Hself.kp = [31m0.15[m[24;9Hself.kd = [31m0.5[m[25;9Hself.prev_error = [31m0[m[26;9Hself.relative_x = [31m0[m[27;9Hself.relative_y = [31m0[m[28;9Hself.am_moving_backwards = [36mTrue[m[30;103H29,21[10C8%[24;21H[?25h[?12$p[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[30;1H[K[30;103H30,21[10C9%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [23;21H[30;103H29[23;21H[?25h[?25l[30;93H~@k[23;21H[30;93H   [22;21H[30;104H8[22;21H[?25h[?25l[30;93H~@k[22;21H[30;93H   [22;22H[30;107H2[22;22H[?25h[?25l[30;93H~@k[22;22H[30;93H   [22;22H[?25h[?25l[30;93H~@k[22;22H[30;93H   [23;21H[30;104H9,21[23;21H[?25h[?25l[30;93H~@k[23;21H[30;93H   [24;22H[30;103H30,22[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H31,22[9C10%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H32,22[9C12%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H33,22[9C13%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H34,8[10C15%[24;8H[?25h[?25l[30;93H~@k[24;8H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H35,0-1[8C16%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H36,22[9C17%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H37,22[9C19%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[30;104H6[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [22;1H[30;104H5,0-1[22;1H[?25h[?25l[30;93H~@k[22;1H[30;93H   [21;8H[30;104H4,8  [21;8H[?25h[?25l[30;93H~@k[21;8H[30;93H   [20;22H[30;104H3,22[20;22H[?25h[?25l[30;93H~@k[20;22H[30;93H   [19;22H[30;104H2[19;22H[?25h[?25l[30;93H~@k[19;22H[30;93H   [18;22H[30;104H1[18;22H[?25h[?25l[30;93H~@k[18;22H[30;93H   [17;22H[30;104H0[17;22H[?25h[?25l[30;93H~@k[17;22H[30;93H   [16;21H[30;103H29,21[16;21H[?25h[?25l[30;93H~@k[16;21H[30;93H   [16;21H[?25h[?25l[30;93H~@k[16;21H[30;93H   [16;20H[30;107H0[16;20H[?25h[?25l[30;93H2[16;20H[?25h[?25l[30;94H5[16;20H[?25h[?25l[30;95Hi[16;20H[30;93H   [16;20H[30;1H[1m-- INSERT --[m[30;103H[K[30;103H29,20[9C19%[16;20H[?25h[?25l[30;107H1[16;21H[?25h[?25l[30;107H2[16;22H[?25h[?25l[16;21H[K[30;107H1[16;21H[?25h[?25l[31m2[m[30;107H2[16;22H[?25h[?25l[31m5[m[30;107H3[16;23H[?25h[30;1H[K[16;22H[?25l[30;93H^[[16;22H[30;93H  [16;23H[30;103H29,22[9C19%[16;22H[?25h[?25l[30;93H~@k[16;22H[30;93H   [17;22H[30;103H30[17;22H[?25h[?25l[30;93H~@k[17;22H[30;93H   [18;22H[30;104H1[18;22H[?25h[?25l[30;93H~@k[18;22H[30;93H   [19;22H[30;104H2[19;22H[?25h[?25l[30;93H~@k[19;22H[30;93H   [20;22H[30;104H3[20;22H[?25h[?25l[30;93H~@k[20;22H[30;93H   [21;8H[30;104H4,8 [21;8H[?25h[?25l[30;93H~@k[21;8H[30;93H   [22;1H[30;104H5,0-1[22;1H[?25h[?25l[30;93H~@k[22;1H[30;93H   [23;22H[30;104H6,22 [23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [24;22H[30;104H7[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;103H[K[30;103H38,22[9C20%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[24;22H[106m([34C)[m[30;103H[K[30;103H39,22[9C21%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[23;22H([34C)[29;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H40,22[9C23%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H41,22[9C24%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H42,22[9C26%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H43,22[9C27%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;1H[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H44,0-1[8C29%[23;1H[?25h[?25l[30;93H~@k[23;1H[30;93H   [24;22H[106m([7C)[m[30;104H5,22 [24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[23;22H([7C)[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,22[9C30%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,22[9C31%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,22[9C33%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,22[9C34%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H50,22[9C36%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,22[9C37%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,22[9C38%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;17H[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,17[9C40%[24;17H[?25h[?25l[30;93H~@k[24;17H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,22[9C41%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,22[9C43%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,22[9C44%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,22[9C45%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;13H[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.header = Header()[30;103H[K[30;103H58,13[9C47%[24;13H[?25h[?25l[30;93H~@k[24;13H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hdrive = AckermannDrive()[30;103H[K[30;103H59,22[9C48%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H60,22[9C50%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H61,0-1[8C51%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H62,22[9C52%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H63,22[9C54%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H64,22[9C55%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.drive = drive[30;103H[K[30;103H65,0-1[8C56%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn(drive.steering_angle)[30;103H[K[30;103H66,22[9C58%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(drive.steering_angle) < [31m0.3[m:[30;103H[K[30;103H67,22[9C59%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hself.drive_pub.publish(drive_cmd)[30;103H[K[30;103H68,22[9C61%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m# self.error_publisher()[m[30;103H[K[30;103H69,22[9C62%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H70,22[9C63%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[24;22H[106m([20C)[m[29;5H[38;5;130mdef[m [36merror_publisher[m(self):[30;103H[K[30;103H71,22[9C65%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[23;22H([20C)[29;9H[31m"""[m[30;103H[K[30;103H72,22[9C66%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;1H[31m        Publish the error between the car and the cone. We will view this[m[30;103H[K[30;103H73,22[9C68%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;1H[31m        with rqt_plot to plot the success of the controller[m[30;103H[K[30;103H74,22[9C69%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;1H[31m        """[m[30;103H[K[30;103H75,0-1[8C70%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Herror_msg = ParkingError()[30;103H[K[30;103H76,22[9C72%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;11H[1;29r[29;1H
[1;30r[30;103H[K[30;103H77,11[9C73%[24;11H[?25h[?25l[30;93H~@k[24;11H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m#################################[m[30;103H[K[30;103H78,22[9C75%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[1;29r[1;1H[2M[1;30r[28;9H[34m# scaling=(math.sqrt(self.relative_x**2 + self.relative_y**2)-self.parking_distance)/(math.sqrt(self.relative_x**[29;1H*2 + self.relative_y**2))[m[30;103H[K[30;103H79,22[9C76%[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [24;11H[30;103H80,11[24;11H[?25h[?25l[30;93H~@k[24;11H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hscaling = [31m1[m[30;103H[K[30;103H81,22[9C78%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;1H[1;29r[29;1H
[1;30r[30;103H[K[30;103H82,0-1[8C79%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m# error_msg.x_error = self.relative_x*scaling[m[30;103H[K[30;103H83,22[9C80%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[1;29r[1;1H[2M[1;30r[28;9H[34m# error_msg.y_error = self.relative_y*scaling[m[29;9Herror_msg.distance_error = math.sqrt(self.relative_x**[31m2[m + self.relative_y**[31m2[m)*scaling[30;103H[K[30;103H84,22[9C83%[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [24;19H[1;29r[29;1H
[1;30r[30;103H[K[30;103H85,19[9C84%[24;19H[?25h[?25l[30;93H~@k[24;19H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9H[34m#################################[m[30;103H[K[30;103H86,0-1[8C86%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H87,22[9C87%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hself.error_pub.publish(error_msg)[30;103H[K[30;103H88,22[9C89%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[30;104H7[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [24;22H[30;104H8[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H89,22[9C90%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[30;104H8[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [22;22H[30;104H7[22;22H[?25h[?25l[30;93H~@k[22;22H[30;93H   [21;1H[30;104H6,0-1[21;1H[?25h[?25l[30;93H~@k[21;1H[30;93H   [22;22H[30;104H7,22 [22;22H[?25h[?25l[30;93H~@k[22;22H[30;93H   [21;1H[30;104H6,0-1[21;1H[?25h[?25l[30;93H~@k[21;1H[30;93H   [20;19H[30;104H5,19 [20;19H[?25h[?25l[30;93H~@k[20;19H[30;93H   [18;22H[30;104H4,22[18;22H[?25h[?25l[30;93H~@k[18;22H[30;93H   [17;22H[30;104H3[17;22H[?25h[?25l[30;104H2,0-1[16;1H[?25h[?25l[30;93H~@k[16;1H[30;93H   [15;22H[30;104H1,22 [15;22H[?25h[?25l[30;104H0,11[14;11H[?25h[?25l[30;103H79,22[13;22H[?25h[?25l[30;93H~@k[13;22H[30;93H   [12;22H[30;104H8[12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [11;11H[30;104H7,11[11;11H[?25h[?25l[30;104H6,22[10;22H[?25h[?25l[30;93H~@k[10;22H[30;93H   [9;1H[30;104H5,0-1[9;1H[?25h[?25l[30;93H~@k[9;1H[30;93H   [8;22H[30;104H4,22 [8;22H[?25h[?25l[30;104H3[7;22H[?25h[?25l[30;93H~@k[7;22H[30;93H   [6;22H[30;104H2[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;9Hdrive.steering_angle = steering_angle[6;22H[106m([20C)[m[30;103H[K[30;103H71,22[9C89%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[7;22H([20C)[30;103H[K[30;103H70,22[9C87%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;9Hdrive = AckermannDrive()[30;103H[K[30;103H69,22[9C86%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd.header = Header()[30;103H[K[30;103H68,22[9C84%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H67,22[9C83%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H66,22[9C82%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H65,0-1[8C80%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H64,22[9C79%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [6;22H[1;29r[1;1H[L[1;30r[1;9H[38;5;130melse[m:[30;103H[K[30;103H63,22[9C78%[6;22H[?25h[?25l[30;93H~@k[6;22H[30;93H   [7;22H[30;104H4[7;22H[?25h[?25l[30;93H~@k[7;22H[30;93H   [8;1H[30;104H5,0-1[8;1H[?25h[?25l[30;93H~@k[8;1H[30;93H   [9;22H[30;104H6,22 [9;22H[?25h[?25l[30;93H~@k[9;22H[30;93H   [10;22H[30;104H7[10;22H[?25h[?25l[30;93H~@k[10;22H[30;93H   [11;22H[30;104H8[11;22H[?25h[?25l[30;93H~@k[11;22H[30;93H   [11;23H[30;107H3[11;23H[?25h[?25l[30;93H~@k[11;23H[30;93H   [10;23H[30;104H7[10;23H[?25h[?25l[30;93H~@k[10;23H[30;93H   [10;24H[30;107H4[10;24H[?25h[?25l[30;93H~@k[10;24H[30;93H   [10;25H[30;107H5[10;25H[?25h[?25l[30;93H~@k[10;25H[30;93H   [10;24H[30;107H4[10;24H[?25h[?25l[30;93H~@k[10;24H[30;93H   [9;24H[30;104H6[9;24H[?25h[?25l[30;104H5,0-1[8;1H[?25h[?25l[30;104H4,24 [7;24H[?25h[?25l[30;93H~@k[7;24H[30;93H   [6;24H[30;104H3[6;24H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H62,24[9C76%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[29;1H[94m@@@                                                                                                                     [m[30;103H[K[30;103H61,0-1[8C75%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H60,24[9C75%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;17Hdirection = -[31m1[m[30;103H[K[30;103H59,24[9C73%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;13H[38;5;130melse[m:[30;103H[K[30;103H58,13[9C72%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H57,24[9C70%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;17Hdirection = [31m1[m[30;103H[K[30;103H56,24[9C69%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H55,24[9C68%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;13H[38;5;130mif[m self.relative_y >[31m0[m:[30;103H[K[30;103H54,24[9C66%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;17H[1;29r[1;1H[L[1;30r[1;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H53,17[9C65%[6;17H[?25h[?25l[30;93H~@k[6;17H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H52,24[9C63%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H51,24[9C62%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H50,24[9C61%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [7;24H[30;104H1[7;24H[?25h[?25l[30;93H~@k[7;24H[30;93H   [8;24H[30;104H2[8;24H[?25h[?25l[30;93H~@k[8;24H[30;93H   [9;17H[30;104H3,17[9;17H[?25h[?25l[30;93H~@k[9;17H[30;93H   [10;24H[30;104H4,24[10;24H[?25h[?25l[30;93H~@k[10;24H[30;93H   [9;17H[30;104H3,17[9;17H[?25h[?25l[30;93H~@k[9;17H[30;93H   [8;24H[30;104H2,24[8;24H[?25h[?25l[30;93H~@k[8;24H[30;93H   [7;24H[30;104H1[7;24H[?25h[?25l[30;93H~@k[7;24H[30;93H   [6;24H[30;104H0[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H49,24[9C59%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = self.relative_y[30;103H[K[30;103H48,24[9C58%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;24H[1;29r[1;1H[L[1;30r[1;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H47,24[9C56%[6;24H[?25h[?25l[30;93H~@k[6;24H[30;93H   [6;25H[30;107H5[6;25H[?25h[?25l[30;93H~@k[6;25H[30;93H   [6;26H[30;107H6[6;26H[?25h[?25l[30;107H7[6;27H[?25h[?25l[30;93H~@k[6;27H[30;93H   [6;28H[30;107H8[6;28H[?25h[?25l[30;107H9[6;29H[?25h[?25l[30;106H30[6;30H[?25h[?25l[30;93H~@k[6;30H[30;93H   [6;31H[6;15H[106m([15C)[m[30;107H1[6;31H[?25h[?25l[30;93H~@k[6;31H[30;93H   [7;31H[6;15H([15C)[30;104H8[7;31H[?25h[?25l[30;93H~@k[7;31H[30;93H   [8;31H[30;104H9[8;31H[?25h[?25l[30;93H~@k[8;31H[30;93H   [9;31H[30;103H50[9;31H[?25h[?25l[30;104H1,30[10;30H[?25h[?25l[30;93H~@k[10;30H[30;93H   [11;31H[30;104H2,31[11;31H[?25h[?25l[30;93H~@k[11;31H[30;93H   [12;17H[30;104H3,17[12;17H[?25h[?25l[30;93H~@k[12;17H[30;93H   [13;30H[30;104H4,30[13;30H[?25h[?25l[30;104H5,31[14;31H[?25h[?25l[30;93H~@k[14;31H[30;93H   [15;31H[30;104H6[15;31H[?25h[?25l[30;93H~@k[15;31H[30;93H   [16;31H[30;104H7[16;31H[?25h[?25l[30;93H~@k[16;31H[30;93H   [17;13H[30;104H8,13[17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [18;31H[30;104H9,31[18;31H[?25h[?25l[30;93H~@k[18;31H[30;93H   [18;32H[30;107H2[18;32H[?25h[?25l[30;93H~@k[18;32H[30;93H   [18;33H[30;107H3[18;33H[?25h[?25l[30;107H4[18;34H[?25h[?25l[30;93H~@k[18;34H[30;93H   [18;35H[30;107H5[18;35H[?25h[?25l[30;107H6[18;36H[?25h[?25l[30;93H~@k[18;36H[30;93H   [18;37H[30;107H7[18;37H[?25h[?25l[30;107H8[18;38H[?25h[?25l[30;93H~@k[18;38H[30;93H   [18;39H[30;107H9[18;39H[?25h[?25l[30;93H~@k[18;39H[30;93H   [18;40H[30;106H40[18;40H[?25h[?25l[30;93H~@k[18;40H[30;93H   [18;41H[30;107H1[18;41H[?25h[?25l[30;107H2[18;42H[?25h[?25l[30;93H~@k[18;42H[30;93H   [18;43H[30;107H3[18;43H[?25h[?25l[30;93H~@k[18;43H[30;93H   [18;44H[30;107H4[18;44H[?25h[?25l[30;93H~@k[18;44H[30;93H   [18;45H[30;107H5[18;45H[?25h[?25l[30;107H6[18;46H[?25h[?25l[30;93H~@k[18;46H[30;93H   [18;47H[30;107H7[18;47H[?25h[?25l[30;93H~@k[18;47H[30;93H   [18;48H[30;107H8[18;48H[?25h[?25l[30;107H9[18;49H[?25h[?25l[30;93H~@k[18;49H[30;93H   [18;50H[30;106H50[18;50H[?25h[?25l[30;107H1[18;51H[?25h[?25l[30;93H~@k[18;51H[30;93H   [18;52H[30;107H2[18;52H[?25h[?25l[30;93H~@k[18;52H[30;93H   [18;53H[30;107H3[18;53H[?25h[?25l[30;107H4[18;54H[?25h[?25l[30;93H~@k[18;54H[30;93H   [18;55H[30;107H5[18;55H[?25h[?25l[30;107H6[18;56H[?25h[?25l[30;107H7[18;57H[?25h[?25l[30;93H~@k[18;57H[30;93H   [18;58H[30;107H8[18;58H[?25h[?25l[30;93H~@k[18;58H[30;93H   [18;59H[30;107H9[18;59H[?25h[?25l[30;93H~@k[18;59H[30;93H   [18;58H[30;107H8[18;58H[?25h[?25l[30;93H~@k[18;58H[30;93H   [18;57H[30;107H7[18;57H[?25h[?25l[30;93H~@k[18;57H[30;93H   [18;56H[30;107H6[18;56H[?25h[?25l[30;93H~@k[18;56H[30;93H   [18;55H[30;107H5[18;55H[?25h[?25l[30;93H~@k[18;55H[30;93H   [18;54H[30;107H4[18;54H[?25h[?25l[30;93H~@k[18;54H[30;93H   [18;55H[30;107H5[18;55H[?25h[?25l[30;93H~@k[18;55H[30;93H   [17;13H[30;104H8,13[17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;12H[30;107H2[17;12H[?25h[?25l[30;93H~@k[17;12H[30;93H   [17;13H[30;107H3[17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [17;13H[?25h[?25l[30;93H~@k[17;13H[30;93H   [16;13H[30;104H7[16;13H[?25h[?25l[30;93H~@k[16;13H[30;93H   [15;13H[30;104H6[15;13H[?25h[?25l[30;93H~@k[15;13H[30;93H   [14;13H[30;104H5[14;13H[?25h[?25l[30;93H~@k[14;13H[30;93H   [13;13H[30;104H4[13;13H[?25h[?25l[30;93H~@k[13;13H[30;93H   [12;13H[30;104H3[12;13H[?25h[?25l[30;104H2[11;13H[?25h[?25l[30;93H~@k[11;13H[30;93H   [10;13H[30;104H1[10;13H[?25h[?25l[30;104H0[9;13H[?25h[?25l[30;93H~@k[9;13H[30;93H   [8;13H[30;103H49[8;13H[?25h[?25l[30;104H8[7;13H[?25h[?25l[30;104H7[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H46,13[9C55%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H45,13[9C54%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H44,0-1[8C52%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H43,13[9C51%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H42,13[9C50%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H41,13[9C48%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H40,13[9C47%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H39,13[9C45%[6;13H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H38,13[9C44%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = [31m0[m[30;103H[K[30;103H37,13[9C43%[6;13H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = [31m0[m[30;103H[K[30;103H36,13[9C41%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,0-1[8C40%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kd = [31m0.25[m[30;103H[K[30;103H34,8[10C38%[6;8H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kp = [31m0.15[m[30;103H[K[30;103H33,13[9C37%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[30;103H[K[30;103H32,13[9C36%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H31,13[9C34%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;13HParkingError, queue_size=[31m10[m)[30;103H[K[30;103H30,13[9C33%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[30;103H[K[30;103H29,13[9C31%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;13HAckermannDriveStamped, queue_size=[31m10[m)[30;103H[K[30;103H28,13[9C30%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[30;103H[K[30;103H27,13[9C29%[6;13H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [2;1Hdifferent for simulator vs racecar[m[30;103H[K[30;103H26,0-1[8C27%[7;1H[?25h[?25l[30;104H5,13 [6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H24,13[9C26%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;13Hself.relative_cone_callback)[30;103H[K[30;103H23,13[9C24%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[30;103H[K[30;103H22,13[9C23%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [7;13H[30;104H3[7;13H[?25h[?25l[30;93H~@k[7;13H[30;93H   [8;13H[30;104H4[8;13H[?25h[?25l[30;93H~@k[8;13H[30;93H   [9;13H[30;104H5[9;13H[?25h[?25l[30;93H~@k[9;13H[30;93H   [10;1H[30;104H6,0-1[10;1H[?25h[?25l[30;93H~@k[10;1H[30;93H   [11;13H[30;104H7,13 [11;13H[?25h[?25l[30;93H~@k[11;13H[30;93H   [12;13H[30;104H8[12;13H[?25h[?25l[30;93H~@k[12;13H[30;93H   [12;14H[30;107H4[12;14H[?25h[?25l[30;93H~@k[12;14H[30;93H   [12;15H[30;107H5[12;15H[?25h[?25l[30;93H~@k[12;15H[30;93H   [12;16H[30;107H6[12;16H[?25h[?25l[30;93H~@k[12;16H[30;93H   [12;17H[30;107H7[12;17H[?25h[?25l[30;107H8[12;18H[?25h[?25l[30;93H~@k[12;18H[30;93H   [12;19H[30;107H9[12;19H[?25h[?25l[30;93H~@k[12;19H[30;93H   [12;20H[30;106H20[12;20H[?25h[?25l[30;93H~@k[12;20H[30;93H   [12;21H[30;107H1[12;21H[?25h[?25l[30;93H~@k[12;21H[30;93H   [12;22H[30;107H2[12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [12;22H[?25h[?25l[30;93H~@k[12;22H[30;93H   [13;22H[30;104H9[13;22H[?25h[?25l[30;93H~@k[13;22H[30;93H   [13;22H[?25h[?25l[30;93Hi[13;22H[30;93H [13;22H[30;1H[1m-- INSERT --[m[30;103H[K[30;103H29,22[9C23%[13;22H[?25h[?25l[30;107H3[13;23H[?25h[?25l[13;22H[K[30;107H2[13;22H[?25h[?25l[13;21H[K[30;107H1[13;21H[?25h[?25l[13;20H[K[30;107H0[13;20H[?25h[?25l[30;104H8[12;20H[?25h[?25l[30;107H1[12;21H[?25h[?25l[30;107H2[12;22H[?25h[?25l[30;107H3[12;23H[?25h[?25l[12;22H[K[30;107H2[12;22H[?25h[?25l[31m0[m[30;107H3[12;23H[?25h[30;1H[K[12;22H[?25l[30;93H^[[12;22H[30;93H  [12;23H[30;103H28,22[9C23%[12;22H[?25h[?25l[30;93H:[12;22H[30;93H[K[30;1H:[?2004h[?25hw[?25l[?25hq[?25l[?25h[?25l[?2004l"parking_controller.py" 101L, 3782C written
[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ vim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3782C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;1H[35mfrom[m std_msgs.msg [35mimport[m Header
[35mfrom[m final_race.msg [35mimport[m ConeLocation, ParkingError
[35mfrom[m ackermann_msgs.msg [35mimport[m AckermannDriveStamped, AckermannDrive

[38;5;130mclass[m [36mParkingController[m():
    [31m"""
    A controller for parking in front of a cone.
    Listens for a relative cone location and publishes control commands.
    Can be used in the simulator and on the real robot.
    """[m
    CIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[13;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[14;13Hself.relative_cone_callback)[16;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [17;1Hdifferent for simulator vs racecar[m[18;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[19;13HAckermannDriveStamped, queue_size=[31m10[m)[20;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[21;13HParkingError, queue_size=[31m10[m)[23;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[24;9Hself.kp = [31m0.10[m[25;9Hself.kd = [31m0[m[26;9Hself.prev_error = [31m0[m[27;9Hself.relative_x = [31m0[m[28;9Hself.relative_y = [31m0[m[29;9Hself.am_moving_backwards = [36mTrue[m[30;103H28,22[10C6%[24;22H[?25h[?12$p[?25l[30;93H~@k[24;22H[30;93H   [24;19H[1;29r[29;1H
[1;30r[30;1H[K[30;103H29,19[10C8%[24;19H[?25h[?25l[30;93H~@k[24;19H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H30,22[10C9%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H31,22[9C10%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H32,22[9C12%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H33,22[9C13%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;8H[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H34,8[10C15%[24;8H[?25h[?25l[30;93H~@k[24;8H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H35,0-1[8C16%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H36,22[9C17%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H37,22[9C19%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;103H[K[30;103H38,22[9C20%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[24;22H[106m([34C)[m[30;103H[K[30;103H39,22[9C21%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[23;22H([34C)[29;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H40,22[9C23%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H41,22[9C24%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H42,22[9C26%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H43,22[9C27%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;1H[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H44,0-1[8C29%[23;1H[?25h[?25l[30;93H~@k[23;1H[30;93H   [24;22H[106m([7C)[m[30;104H5,22 [24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[23;22H([7C)[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,22[9C30%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,22[9C31%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,22[9C33%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,22[9C34%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H50,22[9C36%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,22[9C37%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,22[9C38%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;17H[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,17[9C40%[24;17H[?25h[?25l[30;93H~@k[24;17H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,22[9C41%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,22[9C43%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,22[9C44%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,22[9C45%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;13H[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.header = Header()[30;103H[K[30;103H58,13[9C47%[24;13H[?25h[?25l[30;93H~@k[24;13H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hdrive = AckermannDrive()[30;103H[K[30;103H59,22[9C48%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[30;103H[K[30;103H60,22[9C50%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H61,0-1[8C51%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H62,22[9C52%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [24;22H[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H63,22[9C54%[24;22H[?25h[?25l[30;93H~@k[24;22H[30;93H   [23;22H[30;104H2[23;22H[?25h[?25l[30;93H~@k[23;22H[30;93H   [22;1H[30;104H1,0-1[22;1H[?25h[?25l[30;93H~@k[22;1H[30;93H   [21;22H[30;104H0,22 [21;22H[?25h[?25l[30;93H~@k[21;22H[30;93H   [22;1H[30;104H1,0-1[22;1H[?25h[?25l[30;93H~@k[22;1H[30;93H   [21;22H[30;104H0,22 [21;22H[?25h[?25l[30;93H~@k[21;22H[30;93H   [20;22H[30;103H59[20;22H[?25h[?25l[30;93H~@k[20;22H[30;93H   [19;13H[30;104H8,13[19;13H[?25h[?25l[30;93H~@k[19;13H[30;93H   [18;22H[30;104H7,22[18;22H[?25h[?25l[30;93Hi[18;22H[30;93H [18;22H[30;1H[1m-- INSERT --[m[30;103H[K[30;103H57,22[9C54%[18;22H[?25h[?25l[30;104H8,14[19;14H[?25h[?25l[30;104H9,22[20;22H[?25h[?25l[30;103H61,1 [22;1H[?25h[?25l[30;104H2,22[23;22H[?25h[?25l[30;104H3[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H64,22[9C55%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.drive = drive[30;103H[K[30;103H65,1[10C56%[24;1H[?25h[?25l[30;104H4,22[23;22H[?25h[?25l[30;104H3[22;22H[?25h[?25l[30;104H2[21;22H[?25h[?25l[30;104H1,1 [20;1H[?25h[?25l[30;104H0,22[19;22H[?25h[?25l[30;103H59[18;22H[?25h[?25l[30;104H8,14[17;14H[?25h[?25l[30;104H7,22[16;22H[?25h[?25l[30;104H6[15;22H[?25h[?25l[30;104H5[14;22H[?25h[?25l[30;104H4[13;22H[?25h[?25l[30;104H3,18[12;18H[?25h[?25l[30;104H2,22[11;22H[?25h[?25l[30;104H1[10;22H[?25h[?25l[30;104H0[9;22H[?25h[?25l[30;103H49[8;22H[?25h[?25l[30;104H8[7;22H[?25h[?25l[30;104H7[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H46,22[9C55%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H45,22[9C54%[6;22H[106m([7C)[6;22H[?25h[?25l[1;29r[m[1;1H[L[1;30r[1;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H44,1[10C52%[7;22H([7C)[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H43,22[9C51%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H42,22[9C50%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H41,22[9C48%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H40,22[9C47%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H39,22[9C45%[6;22H[106m([34C)[6;22H[?25h[?25l[1;29r[m[1;1H[L[1;30r[1;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H38,22[9C44%[7;22H([34C)[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = [31m0[m[30;103H[K[30;103H37,22[9C43%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = [31m0[m[30;103H[K[30;103H36,22[9C41%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,1[10C40%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kd = [31m0[m[30;103H[K[30;103H34,9[10C38%[6;9H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kp = [31m0.10[m[30;103H[K[30;103H33,22[9C37%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[30;103H[K[30;103H32,22[9C36%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H31,22[9C34%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HParkingError, queue_size=[31m10[m)[30;103H[K[30;103H30,22[9C33%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[30;103H[K[30;103H29,20[9C31%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HAckermannDriveStamped, queue_size=[31m10[m)[30;103H[K[30;103H28,22[9C30%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[30;103H[K[30;103H27,22[9C29%[6;22H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [2;1Hdifferent for simulator vs racecar[m[30;103H[K[30;103H26,1[10C27%[7;1H[?25h[?25l[30;104H5,22[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H24,22[9C26%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hself.relative_cone_callback)[30;103H[K[30;103H23,22[9C24%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[30;103H[K[30;103H22,22[9C23%[6;22H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;5HCIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[30;103H[K[30;103H21,22[9C20%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;1H[31m    """[m[30;103H[K[30;103H20,1[10C19%[6;1H[?25h[?25l[30;104H1,22[7;22H[?25h[?25l[30;104H2[9;22H[?25h[?25l[30;104H9,20[16;20H[?25h[?25l[30;103H30,22[17;22H[?25h[?25l[30;104H1[18;22H[?25h[?25l[30;104H2[19;22H[?25h[?25l[30;104H1[18;22H[?25h[?25l[30;104H0[17;22H[?25h[?25l[30;103H29,20[16;20H[?25h[?25l[30;104H8,22[15;22H[?25h[?25l[30;104H9,20[16;20H[?25h[?25l[30;103H30,22[17;22H[?25h[?25l[30;104H1[18;22H[?25h[?25l[30;104H2[19;22H[?25h[?25l[30;104H3[20;22H[?25h[?25l[30;104H4,9 [21;9H[?25h[?25l[30;104H5,1[22;1H[?25h[?25l[30;104H6,22[23;22H[?25h[?25l[30;104H7[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;103H[K[30;103H38,22[9C20%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H39,22[9C21%[24;22H[106m([34C)[24;22H[?25h[?25l[1;29r[m[29;1H
[1;30r[29;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H40,22[9C23%[23;22H([34C)[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H41,22[9C24%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H42,22[9C26%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H43,22[9C27%[24;22H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H44,1[10C29%[23;1H[?25h[?25l[24;22H[106m([7C)[m[30;104H5,22[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,22[9C30%[23;22H([7C)[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,22[9C31%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,22[9C33%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,22[9C34%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H50,22[9C36%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,22[9C37%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,22[9C38%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,18[9C40%[24;18H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,22[9C41%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,22[9C43%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,22[9C44%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,22[9C45%[24;22H[?25h[?25l[30;104H6[23;22H[?25h[?25l[30;104H5[22;22H[?25h[?25l[30;104H3,18[20;18H[?25h[?25l[30;104H2,22[19;22H[?25h[?25l[30;104H1[18;22H[?25h[?25l[30;104H0[17;22H[?25h[?25l[30;103H49[16;22H[?25h[?25l[30;104H8[15;22H[?25h[?25l[30;104H7[14;22H[?25h[?25l[30;104H6[13;22H[?25h[?25l[12;22H[106m([7C)[m[30;104H5[12;22H[?25h[?25l([7C)[30;104H4,1 [11;1H[?25h[?25l[12;22H[106m([7C)[m[30;104H5,22[12;22H[?25h[?25l([7C)[30;104H6[13;22H[?25h[?25l[30;104H7[14;22H[?25h[?25l[30;104H8[15;22H[?25h[?25l[30;104H9[16;22H[?25h[?25l[30;103H50[17;22H[?25h[?25l[30;104H2[19;22H[?25h[?25l[30;104H3,18[20;18H[?25h[?25l[30;104H4,22[21;22H[?25h[?25l[30;104H5[22;22H[?25h[?25l[30;104H4[21;22H[?25h[?25l[30;104H3,18[20;18H[?25h[?25l[30;103H47,22[14;22H[?25h[?25l[30;104H6[13;22H[?25h[?25l[12;22H[106m([7C)[m[30;104H5[12;22H[?25h[?25l([7C)[30;104H4,1 [11;1H[?25h[?25l[30;104H3,22[10;22H[?25h[?25l[30;104H2[9;22H[?25h[?25l[30;104H1[8;22H[?25h[?25l[30;104H0[7;22H[?25h[?25l[6;22H[106m([34C)[m[30;103H39[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H38,22[9C44%[7;22H([34C)[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = [31m0[m[30;103H[K[30;103H37,22[9C43%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = [31m0[m[30;103H[K[30;103H36,22[9C41%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,1[10C40%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kd = [31m0[m[30;103H[K[30;103H34,9[10C38%[6;9H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kp = [31m0.10[m[30;103H[K[30;103H33,22[9C37%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[30;103H[K[30;103H32,22[9C36%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H31,22[9C34%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HParkingError, queue_size=[31m10[m)[30;103H[K[30;103H30,22[9C33%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[30;103H[K[30;103H29,20[9C31%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HAckermannDriveStamped, queue_size=[31m10[m)[30;103H[K[30;103H28,22[9C30%[6;22H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[30;103H[K[30;103H27,22[9C29%[6;22H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [2;1Hdifferent for simulator vs racecar[m[30;103H[K[30;103H26,1[10C27%[7;1H[?25h[?25l[30;104H7,22[8;22H[?25h[?25l[30;104H8[9;22H[?25h[?25l[30;104H9,20[10;20H[?25h[?25l[30;104H8,22[9;22H[?25h[?25l[30;107H3[9;23H[?25h[?25l[9;22H[K[30;107H2[9;22H[?25h[?25l[9;21H[K[30;107H1[9;21H[?25h[?25l[9;20H[K[30;107H0[9;20H[?25h[?25l[9;19H[K[30;106H19[9;19H[?25h[?25l[31m1[m[30;106H20[9;20H[?25h[?25l[30;104H9[10;20H[?25h[?25l[30;103H30[11;20H[?25h[?25l[30;104H1[12;20H[?25h[?25l[30;104H2[13;20H[?25h[?25l[30;104H3[14;20H[?25h[?25l[30;104H4,9 [15;9H[?25h[?25l[30;104H5,1[16;1H[?25h[?25l[30;104H6,20[17;20H[?25h[?25l[30;104H7[18;20H[?25h[?25l[30;104H8[19;20H[?25h[?25l[30;104H9[20;20H[?25h[?25l[30;103H40[21;20H[?25h[?25l[30;104H1[22;20H[?25h[?25l[30;104H2[23;20H[?25h[?25l[30;104H3[24;20H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H44,1[10C29%[23;1H[?25h[?25l[30;104H5,20[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,20[9C30%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,20[9C31%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,20[9C33%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,20[9C34%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H50,20[9C36%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,20[9C37%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,20[9C38%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,18[9C40%[24;18H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,20[9C41%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,20[9C43%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,20[9C44%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,20[9C45%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.header = Header()[30;103H[K[30;103H58,14[9C47%[24;14H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive = AckermannDrive()[30;103H[K[30;103H59,20[9C48%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H60,20[9C50%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H61,1[10C51%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H62,20[9C52%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H63,20[9C54%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H64,20[9C55%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.drive = drive[30;103H[K[30;103H65,1[10C56%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn(drive.steering_angle)[30;103H[K[30;103H66,20[9C58%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(drive.steering_angle) < [31m0.3[m:[30;103H[K[30;103H67,20[9C59%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hself.drive_pub.publish(drive_cmd)[30;103H[K[30;103H68,20[9C61%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m# self.error_publisher()[m[30;103H[K[30;103H69,20[9C62%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H70,20[9C63%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;5H[38;5;130mdef[m [36merror_publisher[m(self):[30;103H[K[30;103H71,20[9C65%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[31m"""[m[30;103H[K[30;103H72,20[9C66%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[31m        Publish the error between the car and the cone. We will view this[m[30;103H[K[30;103H73,20[9C68%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[31m        with rqt_plot to plot the success of the controller[m[30;103H[K[30;103H74,20[9C69%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[31m        """[m[30;103H[K[30;103H75,1[10C70%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Herror_msg = ParkingError()[30;103H[K[30;103H76,20[9C72%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H77,12[9C73%[24;12H[?25h[?25l[30;104H6,20[23;20H[?25h[?25l[30;104H5,1 [22;1H[?25h[?25l[30;104H4,20[21;20H[?25h[?25l[30;104H3[20;20H[?25h[?25l[30;104H2[19;20H[?25h[?25l[30;104H1[18;20H[?25h[?25l[30;104H2[19;20H[?25h[?25l[30;104H3[20;20H[?25h[?25l[30;104H4[21;20H[?25h[?25l[1;29r[1;1H[3M[1;30r[27;9H[34m#################################[28;9H# scaling=(math.sqrt(self.relative_x**2 + self.relative_y**2)-self.parking_distance)/(math.sqrt(self.relative_x**[29;1H*2 + self.relative_y**2))[m[30;103H[K[30;103H79,20[9C76%[23;20H[?25h[?25l[30;103H80,12[24;12H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hscaling = [31m1[m[30;103H[K[30;103H81,20[9C78%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H82,1[10C79%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m# error_msg.x_error = self.relative_x*scaling[m[30;103H[K[30;103H83,20[9C80%[24;20H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;9H[34m# error_msg.y_error = self.relative_y*scaling[m[29;9Herror_msg.distance_error = math.sqrt(self.relative_x**[31m2[m + self.relative_y**[31m2[m)*scaling[30;103H[K[30;103H84,20[9C83%[23;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H85,20[9C84%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m#################################[m[30;103H[K[30;103H86,1[10C86%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H87,20[9C87%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.error_pub.publish(error_msg)[30;103H[K[30;103H88,20[9C89%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H89,20[9C90%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[38;5;130mif[m __name__ == [31m'__main__'[m:[30;103H[K[30;103H90,1[10C91%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;5H[38;5;130mtry[m:[30;103H[K[30;103H91,20[9C93%[24;20H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.init_node([31m'ParkingController'[m, anonymous=[36mTrue[m)[30;103H[K[30;103H92,9[10C94%[24;9H[?25h[?25l[30;104H1,20[23;20H[?25h[?25l[30;104H0,1 [22;1H[?25h[?25l[30;103H89,20[21;20H[?25h[?25l[30;104H8[20;20H[?25h[?25l[30;104H7[19;20H[?25h[?25l[30;104H6,1 [18;1H[?25h[?25l[30;104H5,20[17;20H[?25h[?25l[30;104H4[15;20H[?25h[?25l[30;104H3[14;20H[?25h[?25l[30;104H2,1 [13;1H[?25h[?25l[30;104H1,20[12;20H[?25h[?25l[30;104H0,12[11;12H[?25h[?25l[30;103H79,20[10;20H[?25h[?25l[30;104H8[9;20H[?25h[?25l[30;104H7,12[8;12H[?25h[?25l[30;104H6,20[7;20H[?25h[?25l[30;104H5,1 [6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H74,20[9C93%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H73,20[9C91%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H72,20[9C90%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H71,20[9C89%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H70,20[9C87%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive = AckermannDrive()[30;103H[K[30;103H69,20[9C86%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd.header = Header()[30;103H[K[30;103H68,20[9C84%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H67,20[9C83%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H66,20[9C82%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H65,1[10C80%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H64,20[9C79%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[38;5;130melse[m:[30;103H[K[30;103H63,20[9C78%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H62,20[9C76%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[29;1H[94m@@@                                                                                                                     [m[30;103H[K[30;103H61,1[10C75%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H60,20[9C75%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;17Hdirection = -[31m1[m[30;103H[K[30;103H59,20[9C73%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13H[38;5;130melse[m:[30;103H[K[30;103H58,14[9C72%[6;14H[?25h[?25l[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H57,20[9C70%[6;20H[1;29r[1;1H[2L[1;30r[1;17Hrospy.logwarn(self.relative_y)[2;17Hdirection = [31m1[m[30;103H[K[30;103H55,20[9C68%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13H[38;5;130mif[m self.relative_y >[31m0[m:[30;103H[K[30;103H54,20[9C66%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H53,18[9C65%[6;18H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H52,20[9C63%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H51,20[9C62%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H50,20[9C61%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H49,20[9C59%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = self.relative_y[30;103H[K[30;103H48,20[9C58%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H47,20[9C56%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H46,20[9C55%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H45,20[9C54%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H44,1[10C52%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H43,20[9C51%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H42,20[9C50%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H41,20[9C48%[6;20H[1;29r[1;1H[5L[1;30r[1;9Hself.relative_x = [31m0[m[2;9Hself.relative_y = [31m0[m[3;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H36,20[9C41%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,1[10C40%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kd = [31m0[m[30;103H[K[30;103H34,9[10C38%[6;9H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.kp = [31m1[m[30;103H[K[30;103H33,20[9C37%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[30;103H[K[30;103H32,20[9C36%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H31,20[9C34%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HParkingError, queue_size=[31m10[m)[30;103H[K[30;103H30,20[9C33%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[30;103H[K[30;103H29,20[9C31%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13HAckermannDriveStamped, queue_size=[31m10[m)[30;103H[K[30;103H28,20[9C30%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[30;103H[K[30;103H27,20[9C29%[6;20H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [2;1Hdifferent for simulator vs racecar[m[30;103H[K[30;103H26,1[10C27%[7;1H[?25h[?25l[30;104H5,20[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H24,20[9C26%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;13Hself.relative_cone_callback)[30;103H[K[30;103H23,20[9C24%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[30;103H[K[30;103H22,20[9C23%[6;20H[?25h[?25l[1;29r[1;1H[2L[1;30r[1;5HCIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[30;103H[K[30;103H21,20[9C20%[6;20H[?25h[?25l[1;29r[1;1H[L[1;30r[1;1H[31m    """[m[30;103H[K[30;103H20,1[10C19%[6;1H[?25h[?25l[30;104H1,20[7;20H[?25h[?25l[30;104H2[9;20H[?25h[?25l[30;104H3[10;20H[?25h[?25l[30;104H4[11;20H[?25h[?25l[30;104H5[12;20H[?25h[?25l[30;104H6,1 [13;1H[?25h[?25l[30;104H7,20[14;20H[?25h[?25l[30;104H8[15;20H[?25h[?25l[15;19H[K[30;106H19[15;19H[?25h[?25l[31m0[m[30;106H20[15;20H[?25h[?25l[31m.[m[30;107H1[15;21H[?25h[?25l[31m5[m[30;107H2[15;22H[?25h[?25l[30;104H9,20[16;20H[?25h[?25l[30;103H30,22[17;22H[?25h[?25l[30;104H4,9 [21;9H[?25h[?25l[30;104H5,1[22;1H[?25h[?25l[30;104H6,22[23;22H[?25h[?25l[30;104H7[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;103H[K[30;103H38,22[9C20%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H39,22[9C21%[24;22H[106m([34C)[24;22H[?25h[?25l[1;29r[m[29;1H
[1;30r[29;9Hrospy.logwarn(self.kd)[30;103H[K[30;103H40,22[9C23%[23;22H([34C)[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H41,22[9C24%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H42,22[9C26%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H43,22[9C27%[24;22H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H44,1[10C29%[23;1H[?25h[?25l[24;22H[106m([7C)[m[30;104H5,22[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,22[9C30%[23;22H([7C)[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,22[9C31%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,22[9C33%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,22[9C34%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn(self.relative_y)[30;103H[K[30;103H50,22[9C36%[24;22H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,22[9C37%[24;22H[?25h[?25l[30;104H0[23;22H[?25h[?25l[30;103H49[22;22H[?25h[?25l[30;104H8[21;22H[?25h[?25l[30;104H7[20;22H[?25h[?25l[30;104H6[19;22H[?25h[?25l[18;22H[106m([7C)[m[30;104H5[18;22H[?25h[?25l([7C)[30;104H6[19;22H[?25h[?25l[30;103H50[23;22H[?25h[?25l[30;104H1[24;22H[?25h[?25l[30;104H0[23;22H[?25h[?25l[30;103H49[22;22H[?25h[?25l[30;104H8[21;22H[?25h[?25l[30;104H7[20;22H[?25h[?25l[30;104H6[19;22H[?25h[?25l[18;22H[106m([7C)[m[30;104H5[18;22H[?25h[?25l([7C)[30;104H4,1 [17;1H[?25h[?25l[30;104H3,22[16;22H[?25h[?25l[30;104H2[15;22H[?25h[?25l[30;104H1[14;22H[?25h[?25l[30;104H0[13;22H[?25h[?25l[12;22H[106m([34C)[m[30;103H39[12;22H[?25h[?25l([34C)[30;104H8[11;22H[?25h[?25l[12;22H[106m([34C)[m[30;104H9[12;22H[?25h[?25l([34C)[30;103H40[13;22H[?25h[?25l[30;104H1[14;22H[?25h[?25l[30;104H2[15;22H[?25h[?25l[30;104H3[16;22H[?25h[?25l[30;104H4,1 [17;1H[?25h[?25l[18;22H[106m([7C)[m[30;104H5,22[18;22H[?25h[?25l([7C)[30;104H6[19;22H[?25h[?25l[18;22H[106m([7C)[m[30;104H5[18;22H[?25h[?25l([7C)[30;107H1[18;21H[?25h[?25l[30;107H0[18;20H[?25h[?25l[30;106H19[18;19H[?25h[?25l[30;107H8[18;18H[?25h[?25l[30;107H7[18;17H[?25h[?25l[30;107H6[18;16H[?25h[?25l[30;107H5[18;15H[?25h[?25l[30;107H4[18;14H[?25h[?25l[30;107H3[18;13H[?25h[?25l[30;107H2[18;12H[?25h[?25l[30;107H1[18;11H[?25h[?25l[30;107H0[18;10H[?25h[?25l[30;106H9 [18;9H[?25h[?25l[34m#rospy.logwarn(self.kd)[m[30;106H10[18;10H[?25h[?25l[34m rospy.logwarn(self.kd)[m[30;107H1[18;11H[?25h[?25l[30;104H6[19;11H[?25h[?25l[30;104H7[20;11H[?25h[?25l[30;104H8[21;11H[?25h[?25l[30;104H9[22;11H[?25h[?25l[30;104H8[21;11H[?25h[?25l[30;107H0[21;10H[?25h[?25l[30;107H1[21;11H[?25h[?25l[30;107H2[21;12H[?25h[?25l[30;107H3[21;13H[?25h[?25l[34m#rospy.logwarn(self.relative_y)[m[30;107H4[21;14H[?25h[?25l[34m rospy.logwarn(self.relative_y)[m[30;107H5[21;15H[?25h[?25l[30;104H9[22;15H[?25h[?25l[30;107H4[22;14H[?25h[?25l[30;103H50[23;14H[?25h[?25l[34m#   rospy.logwarn(self.relative_y)[m[30;107H5[23;15H[?25h[?25l[3C[34m rospy.logwarn(self.relative_y)[m[30;107H6[23;16H[?25h[?25l[30;104H1[24;16H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,16[9C38%[24;16H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,16[9C40%[24;16H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,16[9C41%[24;16H[?25h[?25l[30;104H3[23;16H[?25h[?25l[30;104H2[22;16H[?25h[?25l[30;104H1[21;16H[?25h[?25l[30;104H0[20;16H[?25h[?25l[30;104H1[21;16H[?25h[?25l[30;104H2[22;16H[?25h[?25l[30;104H3[23;16H[?25h[?25l[30;104H4[24;16H[?25h[?25l[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,16[9C43%[24;16H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,16[9C44%[24;16H[?25h[?25l[30;104H5[23;16H[?25h[?25l[30;104H6[24;16H[?25h[?25l[30;104H5[23;16H[?25h[?25l[34m# rospy.logwarn(self.relative_y)[m[30;107H7[23;17H[?25h[?25l[1C[34m rospy.logwarn(self.relative_y)[m[30;107H8[23;18H[?25h[?25l[30;104H6[24;18H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,18[9C45%[24;18H[?25h[30;1H[K[24;17H[?25l[30;93H^[[24;17H[30;93H  [24;18H[30;103H57,17[9C45%[24;17H[?25h[?25l[30;93H:[24;17H[30;93H[K[30;1H:[?2004h[?25hw[?25l[?25hq[?25l[?25h[?25l[?2004l"parking_controller.py" 101L, 3789C written
[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ vim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3789C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;9Hself.prev_error = self.relative_y[3;9H[34m# rospy.logwarn(self.kd)[m[4;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[5;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[6;13H[34m# rospy.logwarn(self.relative_y)[m[7;13H[38;5;130mif[m self.relative_y >[31m0[m:[8;14H[34m#    rospy.logwarn(self.relative_y)[m[9;17Hdirection = [31m1[m[10;17Hrospy.logwarn([31m"TURNING LEFT"[m)[11;13H[38;5;130melse[m:[12;17Hdirection = -[31m1[m[13;16H[34m#  rospy.logwarn(self.relative_y)[m[14;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[15;13Hsteering_angle = direction* self.kp + self.kd * de[16;9H[38;5;130melse[m:[17;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[18;8H[34m#  rospy.logwarn(steering_amount)[m[20;9Hdrive_cmd = AckermannDriveStamped()[21;9Hdrive_cmd.header = Header()[22;9Hdrive = AckermannDrive()[24;9Hdrive.steering_angle = steering_angle[25;9Hdrive.speed = [31m4.0[m[26;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[27;9H#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[28;9Hdrive_cmd.drive = drive[29;9Hrospy.logwarn(drive.steering_angle)[30;103H57,17[9C58%[15;17H[?25h[?12$p[?25l[30;93H~@k[15;17H[30;93H   [16;13H[30;104H8,13[16;13H[?25h[?25l[30;93H~@k[16;13H[30;93H   [17;17H[30;104H9,17[17;17H[?25h[?25l[30;93H~@k[17;17H[30;93H   [18;17H[30;103H60[18;17H[?25h[?25l[30;93H~@k[18;17H[30;93H   [17;17H[30;103H59[17;17H[?25h[?25l[30;93H~@k[17;17H[30;93H   [16;13H[30;104H8,13[16;13H[?25h[?25l[30;93H~@k[16;13H[30;93H   [15;17H[30;104H7,17[15;17H[?25h[?25l[30;93H~@k[15;17H[30;93H   [15;18H[30;107H8[15;18H[?25h[?25l[30;93H~@k[15;18H[30;93H   [15;19H[30;107H9[15;19H[?25h[?25l[30;106H20[15;20H[?25h[?25l[30;107H1[15;21H[?25h[?25l[30;107H2[15;22H[?25h[?25l[30;107H3[15;23H[?25h[?25l[30;107H4[15;24H[?25h[?25l[30;107H5[15;25H[?25h[?25l[30;93H~@k[15;25H[30;93H   [15;26H[30;107H6[15;26H[?25h[?25l[30;93H~@k[15;26H[30;93H   [15;27H[30;107H7[15;27H[?25h[?25l[30;93H~@k[15;27H[30;93H   [15;28H[30;107H8[15;28H[?25h[?25l[30;93H~@k[15;28H[30;93H   [15;29H[30;107H9[15;29H[?25h[?25l[30;93H~@k[15;29H[30;93H   [15;30H[30;106H30[15;30H[?25h[?25l[30;93H~@k[15;30H[30;93H   [15;31H[30;107H1[15;31H[?25h[?25l[30;93H~@k[15;31H[30;93H   [15;32H[30;107H2[15;32H[?25h[?25l[30;93H~@k[15;32H[30;93H   [15;33H[30;107H3[15;33H[?25h[?25l[30;93H~@k[15;33H[30;93H   [15;34H[30;107H4[15;34H[?25h[?25l[30;93H~@k[15;34H[30;93H   [15;35H[30;107H5[15;35H[?25h[?25l[30;93H~@k[15;35H[30;93H   [15;36H[30;107H6[15;36H[?25h[?25l[30;93H~@k[15;36H[30;93H   [15;37H[30;107H7[15;37H[?25h[?25l[30;93H~@k[15;37H[30;93H   [15;38H[30;107H8[15;38H[?25h[?25l[30;93H~@k[15;38H[30;93H   [15;39H[30;107H9[15;39H[?25h[?25l[30;93H~@k[15;39H[30;93H   [15;38H[30;107H8[15;38H[?25h[?25l[30;93H~@k[15;38H[30;93H   [15;37H[30;107H7[15;37H[?25h[?25l[30;93H~@k[15;37H[30;93H   [15;38H[30;107H8[15;38H[?25h[?25l[30;93H~@k[15;38H[30;93H   [15;39H[30;107H9[15;39H[?25h[?25l[30;93H<20>[15;39H[30;93H    [15;40H[30;106H40[15;40H[?25h[?25l[30;93H~@k[15;40H[30;93H   [14;40H[30;104H6[14;40H[?25h[?25l[30;93H~@k[14;40H[30;93H   [15;40H[30;104H7[15;40H[?25h[?25l[30;93H~@k[15;40H[30;93H   [14;40H[30;104H6[14;40H[?25h[?25l[30;93H~@k[14;40H[30;93H   [13;40H[30;104H5[13;40H[?25h[?25l[30;93H~@k[13;40H[30;93H   [14;40H[30;104H6[14;40H[?25h[?25l[30;93H~@k[14;40H[30;93H   [15;40H[30;104H7[15;40H[?25h[?25l[30;93H~@k[15;40H[30;93H   [14;40H[30;104H6[14;40H[?25h[?25l[30;93H~@k[14;40H[30;93H   [13;40H[30;104H5[13;40H[?25h[?25l[30;93H~@k[13;40H[30;93H   [14;40H[30;104H6[14;40H[?25h[?25l[30;93H~@k[14;40H[30;93H   [15;40H[30;104H7[15;40H[?25h[?25l[30;93H~@k[15;40H[30;93H   [15;39H[30;106H39[15;39H[?25h[?25l[30;93H~@k[15;39H[30;93H   [15;38H[30;107H8[15;38H[?25h[?25l[30;93H~@k[15;38H[30;93H   [15;37H[30;107H7[15;37H[?25h[?25l[30;107H6[15;36H[?25h[?25l[30;107H5[15;35H[?25h[?25l[30;93H~@k[15;35H[30;93H   [15;34H[30;107H4[15;34H[?25h[?25l[30;93H~@k[15;34H[30;93H   [15;33H[30;107H3[15;33H[?25h[?25l[30;93H~@k[15;33H[30;93H   [15;32H[30;107H2[15;32H[?25h[?25l[30;93H~@k[15;32H[30;93H   [15;31H[30;107H1[15;31H[?25h[?25l[30;93H~@k[15;31H[30;93H   [15;30H[30;107H0[15;30H[?25h[?25l[30;93H~@k[15;30H[30;93H   [15;29H[30;106H29[15;29H[?25h[?25l[30;93H~@k[15;29H[30;93H   [15;28H[30;107H8[15;28H[?25h[?25l[30;93H~@k[15;28H[30;93H   [15;27H[30;107H7[15;27H[?25h[?25l[30;93H~@k[15;27H[30;93H   [15;26H[30;107H6[15;26H[?25h[?25l[30;93H~@k[15;26H[30;93H   [15;25H[30;107H5[15;25H[?25h[?25l[30;93H~@k[15;25H[30;93H   [15;24H[30;107H4[15;24H[?25h[?25l[30;93H~@k[15;24H[30;93H   [15;23H[30;107H3[15;23H[?25h[?25l[30;93H~@k[15;23H[30;93H   [15;22H[30;107H2[15;22H[?25h[?25l[30;93H~@k[15;22H[30;93H   [15;21H[30;107H1[15;21H[?25h[?25l[30;93H~@k[15;21H[30;93H   [15;20H[30;107H0[15;20H[?25h[?25l[30;93H~@k[15;20H[30;93H   [15;19H[30;106H19[15;19H[?25h[?25l[30;93H~@k[15;19H[30;93H   [15;18H[30;107H8[15;18H[?25h[?25l[30;93H~@k[15;18H[30;93H   [14;18H[30;104H6[14;18H[?25h[?25l[30;93H~@k[14;18H[30;93H   [13;18H[30;104H5[13;18H[?25h[?25l[30;93H~@k[13;18H[30;93H   [12;18H[30;104H4[12;18H[?25h[?25l[30;93H~@k[12;18H[30;93H   [11;17H[30;104H3,17[11;17H[?25h[?25l[30;93H~@k[11;17H[30;93H   [10;18H[30;104H2,18[10;18H[?25h[?25l[30;93H~@k[10;18H[30;93H   [9;18H[30;104H1[9;18H[?25h[?25l[30;93H~@k[9;18H[30;93H   [8;18H[30;104H0[8;18H[?25h[?25l[30;93H~@k[8;18H[30;93H   [7;18H[30;103H49[7;18H[?25h[?25l[30;93H~@k[7;18H[30;93H   [6;18H[30;104H8[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hde = self.relative_y-self.prev_error[30;1H[K[30;103H47,18[9C56%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H46,18[9C55%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H45,18[9C54%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H44,0-1[8C52%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H43,18[9C51%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H42,18[9C50%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H41,18[9C48%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [7;18H[30;104H2[7;18H[?25h[?25l[30;93H~@k[7;18H[30;93H   [8;18H[30;104H3[8;18H[?25h[?25l[30;93H~@k[8;18H[30;93H   [7;18H[30;104H2[7;18H[?25h[?25l[30;93H~@k[7;18H[30;93H   [6;18H[30;104H1[6;18H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H40,18[9C47%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H39,18[9C45%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H38,18[9C44%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = [31m0[m[30;103H[K[30;103H37,18[9C43%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = [31m0[m[30;103H[K[30;103H36,18[9C41%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,0-1[8C40%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;8H[1;29r[1;1H[L[1;30r[1;9Hself.kd = [31m0[m[30;103H[K[30;103H34,8[10C38%[6;8H[?25h[?25l[30;93H~@k[6;8H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.kp = [31m0.5[m[30;103H[K[30;103H33,18[9C37%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[30;103H[K[30;103H32,18[9C36%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H31,18[9C34%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;13HParkingError, queue_size=[31m10[m)[30;103H[K[30;103H30,18[9C33%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[30;103H[K[30;103H29,18[9C31%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;13HAckermannDriveStamped, queue_size=[31m10[m)[30;103H[K[30;103H28,18[9C30%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[30;103H[K[30;103H27,18[9C29%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [7;1H[1;29r[1;1H[2L[1;30r[1;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [2;1Hdifferent for simulator vs racecar[m[30;103H[K[30;103H26,0-1[8C27%[7;1H[?25h[?25l[30;93H~@k[7;1H[30;93H   [6;18H[30;104H5,18 [6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H24,18[9C26%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;13Hself.relative_cone_callback)[30;103H[K[30;103H23,18[9C24%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [6;18H[1;29r[1;1H[L[1;30r[1;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[30;103H[K[30;103H22,18[9C23%[6;18H[?25h[?25l[30;93H~@k[6;18H[30;93H   [7;18H[30;104H3[7;18H[?25h[?25l[30;93H~@k[7;18H[30;93H   [8;18H[30;104H4[8;18H[?25h[?25l[30;93H~@k[8;18H[30;93H   [9;18H[30;104H5[9;18H[?25h[?25l[30;93H~@k[9;18H[30;93H   [10;1H[30;104H6,0-1[10;1H[?25h[?25l[30;93H~@k[10;1H[30;93H   [11;18H[30;104H7,18 [11;18H[?25h[?25l[30;93H~@k[11;18H[30;93H   [12;18H[30;104H8[12;18H[?25h[?25l[30;93H~@k[12;18H[30;93H   [12;19H[30;107H9[12;19H[?25h[?25l[30;93H~@k[12;19H[30;93H   [12;20H[30;106H20[12;20H[?25h[?25l[30;93H~@k[12;20H[30;93H   [12;21H[30;107H1[12;21H[?25h[?25l[30;93H~@k[12;21H[30;93H   [12;21H[?25h[?25l[30;93Hi[12;21H[30;93H [12;21H[30;1H[1m-- INSERT --[m[30;103H[K[30;103H28,21[9C23%[12;21H[?25h[?25l[30;107H2[12;22H[?25h[?25l[12;21H[K[30;107H1[12;21H[?25h[?25l[31m1[m[30;107H2[12;22H[?25h[30;1H[K[12;21H[?25l[30;93H^[[12;21H[30;93H  [12;22H[30;103H28,21[9C23%[12;21H[?25h[?25l[30;93H:[12;21H[30;93H[K[30;1H:[?2004h[?25hw[?25l[?25hq[?25l[?25h[?25l[?2004l"parking_controller.py" 101L, 3789C written
[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ vim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3789C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;1H[35mfrom[m std_msgs.msg [35mimport[m Header
[35mfrom[m final_race.msg [35mimport[m ConeLocation, ParkingError
[35mfrom[m ackermann_msgs.msg [35mimport[m AckermannDriveStamped, AckermannDrive

[38;5;130mclass[m [36mParkingController[m():
    [31m"""
    A controller for parking in front of a cone.
    Listens for a relative cone location and publishes control commands.
    Can be used in the simulator and on the real robot.
    """[m
    CIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[13;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[14;13Hself.relative_cone_callback)[16;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [17;1Hdifferent for simulator vs racecar[m[18;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[19;13HAckermannDriveStamped, queue_size=[31m10[m)[20;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[21;13HParkingError, queue_size=[31m10[m)[23;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[24;9Hself.kp = [31m0.1[m[25;9Hself.kd = [31m0[m[26;9Hself.prev_error = [31m0[m[27;9Hself.relative_x = [31m0[m[28;9Hself.relative_y = [31m0[m[29;9Hself.am_moving_backwards = [36mTrue[m[30;103H28,21[10C6%[24;21H[?25h[?25l[30;93H^[[24;21H[30;95H[[24;21H[30;96H>[24;21H[30;97H0[24;21H[30;98H;[24;21H[30;99H1[24;21H[30;100H0[24;21H[30;101H;[24;21H[30;93H         [24;21H[?12$p[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;19H[1;29r[29;1H
[1;30r[30;1H[K[30;103H29,19[10C8%[24;19H[?25h[?25l[30;93H~@k[24;19H[30;93H   [24;21H[1;29r[29;1H
[1;30r[30;103H[K[30;103H30,21[10C9%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H31,21[9C10%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H32,21[9C12%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H33,21[9C13%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H34,8[10C15%[24;8H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H35,0-1[8C16%[24;1H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H36,21[9C17%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H37,21[9C19%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;103H[K[30;103H38,21[9C20%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H39,21[9C21%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m# rospy.logwarn(self.kd)[m[30;103H[K[30;103H40,21[9C23%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H41,21[9C24%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H42,21[9C26%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;13H[34m# rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H43,21[9C27%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [23;1H[1;29r[1;1H[2M[1;30r[28;13H[38;5;130mif[m self.relative_y >[31m0[m:[29;14H[34m#    rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H44,0-1[8C29%[23;1H[?25h[?25l[30;104H5,21 [24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hdirection = [31m1[m[30;103H[K[30;103H46,21[9C30%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H47,21[9C31%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;13H[38;5;130melse[m:[30;103H[K[30;103H48,21[9C33%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;17Hdirection = -[31m1[m[30;103H[K[30;103H49,21[9C34%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;16H[34m#  rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H50,21[9C36%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[30;103H[K[30;103H51,21[9C37%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H52,21[9C38%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;17H[1;29r[29;1H
[1;30r[29;9H[38;5;130melse[m:[30;103H[K[30;103H53,17[9C40%[24;17H[?25h[?25l[30;93H~@k[24;17H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H54,21[9C41%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H55,21[9C43%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H56,21[9C44%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H57,21[9C45%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;13H[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.header = Header()[30;103H[K[30;103H58,13[9C47%[24;13H[?25h[?25l[30;93H~@k[24;13H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hdrive = AckermannDrive()[30;103H[K[30;103H59,21[9C48%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H60,21[9C50%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H61,0-1[8C51%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H62,21[9C52%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H63,21[9C54%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H64,21[9C55%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hdrive_cmd.drive = drive[30;103H[K[30;103H65,0-1[8C56%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hrospy.logwarn(drive.steering_angle)[30;103H[K[30;103H66,21[9C58%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130mif[m [36mabs[m(drive.steering_angle) < [31m0.3[m:[30;103H[K[30;103H67,21[9C59%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;13Hself.drive_pub.publish(drive_cmd)[30;103H[K[30;103H68,21[9C61%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m# self.error_publisher()[m[30;103H[K[30;103H69,21[9C62%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H70,21[9C63%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;5H[38;5;130mdef[m [36merror_publisher[m(self):[30;103H[K[30;103H71,21[9C65%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[31m"""[m[30;103H[K[30;103H72,21[9C66%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[31m        Publish the error between the car and the cone. We will view this[m[30;103H[K[30;103H73,21[9C68%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;1H[31m        with rqt_plot to plot the success of the controller[m[30;103H[K[30;103H74,21[9C69%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;1H[1;29r[29;1H
[1;30r[29;1H[31m        """[m[30;103H[K[30;103H75,0-1[8C70%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Herror_msg = ParkingError()[30;103H[K[30;103H76,21[9C72%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;11H[1;29r[29;1H
[1;30r[30;103H[K[30;103H77,11[9C73%[24;11H[?25h[?25l[30;93H~@k[24;11H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m#################################[m[30;103H[K[30;103H78,21[9C75%[24;21H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;9H[34m# scaling=(math.sqrt(self.relative_x**2 + self.relative_y**2)-self.parking_distance)/(math.sqrt(self.relative_x**[29;1H*2 + self.relative_y**2))[m[30;103H[K[30;103H79,21[9C76%[23;21H[?25h[?25l[30;103H80,1[24;11H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hscaling = [31m1[m[30;103H[K[30;103H81,21[9C78%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H82,0-1[8C79%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9H[34m# error_msg.x_error = self.relative_x*scaling[m[30;103H[K[30;103H83,21[9C80%[24;21H[?25h[?25l[1;29r[1;1H[2M[1;30r[28;9H[34m# error_msg.y_error = self.relative_y*scaling[m[29;9Herror_msg.distance_error = math.sqrt(self.relative_x**[31m2[m + self.relative_y**[31m2[m)*scaling[30;103H[K[30;103H84,21[9C83%[23;21H[?25h[?25l[1;29r[29;1H
[1;30r[30;103H[K[30;103H85,19[9C84%[24;19H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[34m#################################[m[30;103H[K[30;103H86,0-1[8C86%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[30;103H[K[30;103H87,21[9C87%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9Hself.error_pub.publish(error_msg)[30;103H[K[30;103H88,21[9C89%[24;21H[?25h[?25l[30;93H~@k[24;21H[30;93H   [24;21H[1;29r[29;1H
[1;30r[30;103H[K[30;103H89,21[9C90%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;1H[38;5;130mif[m __name__ == [31m'__main__'[m:[30;103H[K[30;103H90,0-1[8C91%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;5H[38;5;130mtry[m:[30;103H[K[30;103H91,21[9C93%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.init_node([31m'ParkingController'[m, anonymous=[36mTrue[m)[30;103H[K[30;103H92,8[10C94%[24;8H[?25h[?25l[30;93H~@k[24;8H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;9HParkingController()[30;103H[K[30;103H93,21[9C95%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9Hrospy.spin()[30;103H[K[30;103H94,0-1[8C97%[24;1H[?25h[?25l[30;93H~@k[24;1H[30;93H   [24;21H[1;29r[29;1H
[1;30r[29;5H[38;5;130mexcept[m rospy.ROSInterruptException:[30;103H[K[30;103H95,21[9C98%[24;21H[?25h[?25l[1;29r[29;1H
[1;30r[29;9H[38;5;130mpass[m[30;103H[K[30;103H96,8[10CBot[24;8H[?25h[?25l[30;104H7,21[25;21H[?25h[?25l[30;93H~@k[25;21H[30;93H   [26;21H[30;104H8[26;21H[?25h[?25l[30;93H~@k[26;21H[30;93H   [27;20H[106m()[m[30;104H9,20[27;20H[?25h[?25l[30;93H~@k[27;20H[30;93H   [28;21H[27;19H()[30;103H100,21[28;21H[?25h[?25l[30;105H1,12[29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [29;12H[?25h[?25l[30;93H~@k[29;12H[30;93H   [28;21H[30;105H0,21[28;21H[?25h[?25l[30;93H~@k[28;21H[30;93H   [27;20H[106m()[m[30;103H99,20 [27;20H[?25h[?25l()[30;104H8,21[26;21H[?25h[?25l[30;104H7[25;21H[?25h[?25l[30;104H6,8 [24;8H[?25h[?25l[30;93H~@k[24;8H[30;93H   [23;21H[30;104H5,21[23;21H[?25h[?25l[30;93H~@k[23;21H[30;93H   [22;1H[30;104H4,0-1[22;1H[?25h[?25l[30;104H3,21 [21;21H[?25h[?25l[30;93H~@k[21;21H[30;93H   [20;8H[30;104H2,8 [20;8H[?25h[?25l[30;93H~@k[20;8H[30;93H   [19;21H[30;104H1,21[19;21H[?25h[?25l[30;93H~@k[19;21H[30;93H   [18;1H[30;104H0,0-1[18;1H[?25h[?25l[30;103H89,21 [17;21H[?25h[?25l[30;93H~@k[17;21H[30;93H   [16;21H[30;104H8[16;21H[?25h[?25l[30;93H~@k[16;21H[30;93H   [15;21H[30;104H7[15;21H[?25h[?25l[30;93H~@k[15;21H[30;93H   [14;1H[30;104H6,0-1[14;1H[?25h[?25l[30;93H~@k[14;1H[30;93H   [13;19H[30;104H5,19 [13;19H[?25h[?25l[30;104H4,21[11;21H[?25h[?25l[30;93H~@k[11;21H[30;93H   [10;21H[30;104H3[10;21H[?25h[?25l[30;104H2,0-1[9;1H[?25h[?25l[30;93H~@k[9;1H[30;93H   [8;21H[30;104H1,21 [8;21H[?25h[?25l[30;93H~@k[8;21H[30;93H   [7;11H[30;104H0,1[7;11H[?25h[?25l[30;93H~@k[7;11H[30;93H   [6;21H[30;103H79,2[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;13Hself.drive_pub.publish(drive_cmd)[30;103H[K[30;103H78,21[9C98%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;11H[1;29r[1;1H[L[1;30r[1;9H[38;5;130mif[m [36mabs[m(drive.steering_angle) < [31m0.3[m:[30;103H[K[30;103H77,11[9C97%[6;11H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn(drive.steering_angle)[30;103H[K[30;103H76,21[9C95%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd.drive = drive[30;103H[K[30;103H75,0-1[8C94%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9H[34m#rospy.loginfo("steering angle: " + str(drive.steering_angle))[m[30;103H[K[30;103H74,21[9C93%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9H[34m#rospy.loginfo("speed: " + str(drive.speed))[m[30;103H[K[30;103H73,21[9C91%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hdrive.speed = [31m4.0[m[30;103H[K[30;103H72,21[9C90%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hdrive.steering_angle = steering_angle[30;103H[K[30;103H71,21[9C89%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H70,21[9C87%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hdrive = AckermannDrive()[30;103H[K[30;103H69,21[9C86%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd.header = Header()[30;103H[K[30;103H68,21[9C84%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hdrive_cmd = AckermannDriveStamped()[30;103H[K[30;103H67,21[9C83%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H66,21[9C82%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;8H[34m#  rospy.logwarn(steering_amount)[m[30;103H[K[30;103H65,0-1[8C80%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = self.relative_y * self.kp + self.kd * de[30;103H[K[30;103H64,21[9C79%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9H[38;5;130melse[m:[30;103H[K[30;103H63,21[9C78%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;13Hsteering_angle = direction* self.kp + self.kd * de[30;103H[K[30;103H62,21[9C76%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING RIGHT"[m)[29;1H[94m@@@                                                                                                                     [m[30;103H[K[30;103H61,0-1[8C75%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;16H[34m#  rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H60,21[9C75%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;17Hdirection = -[31m1[m[30;103H[K[30;103H59,21[9C73%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;13H[1;29r[1;1H[L[1;30r[1;13H[38;5;130melse[m:[30;103H[K[30;103H58,13[9C72%[6;13H[?25h[?25l[30;93H~@k[6;13H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;17Hrospy.logwarn([31m"TURNING LEFT"[m)[30;103H[K[30;103H57,21[9C70%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;17Hdirection = [31m1[m[30;103H[K[30;103H56,21[9C69%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;14H[34m#    rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H55,21[9C68%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;13H[38;5;130mif[m self.relative_y >[31m0[m:[30;103H[K[30;103H54,21[9C66%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;17H[1;29r[1;1H[L[1;30r[1;13H[34m# rospy.logwarn(self.relative_y)[m[30;103H[K[30;103H53,17[9C65%[6;17H[?25h[?25l[30;93H~@k[6;17H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9H[38;5;130mif[m [36mabs[m(self.relative_y) > [31m1[m:[30;103H[K[30;103H52,21[9C63%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hsteering_amount = [36mmin[m([31m0.18[m, [36mabs[m(relative_angle/[31m2[m))[30;103H[K[30;103H51,21[9C62%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [7;21H[30;104H2[7;21H[?25h[?25l[30;93H~@k[7;21H[30;93H   [8;17H[30;104H3,17[8;17H[?25h[?25l[30;93H~@k[8;17H[30;93H   [7;21H[30;104H2,21[7;21H[?25h[?25l[30;93H~@k[7;21H[30;93H   [6;21H[30;104H1[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9H[34m# rospy.logwarn(self.kd)[m[30;103H[K[30;103H50,21[9C61%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[30;103H[K[30;103H49,21[9C59%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = self.relative_y[30;103H[K[30;103H48,21[9C58%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hde = self.relative_y-self.prev_error[30;103H[K[30;103H47,21[9C56%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[30;103H[K[30;103H46,21[9C55%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9H[34m# notes on coordinate system: [m[30;103H[K[30;103H45,21[9C54%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hrospy.logwarn((self.relative_x, self.relative_y))[30;103H[K[30;103H44,0-1[8C52%[6;1H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = msg.x_pos[30;103H[K[30;103H43,21[9C51%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = msg.y_pos[30;103H[K[30;103H42,21[9C50%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[30;103H[K[30;103H41,21[9C48%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H40,21[9C47%[6;21H[?25h[?25l[1;29r[1;1H[L[1;30r[30;103H[K[30;103H39,21[9C45%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hself.am_moving_backwards = [36mTrue[m[30;103H[K[30;103H38,21[9C44%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hself.relative_y = [31m0[m[30;103H[K[30;103H37,21[9C43%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [6;21H[1;29r[1;1H[L[1;30r[1;9Hself.relative_x = [31m0[m[30;103H[K[30;103H36,21[9C41%[6;21H[?25h[?25l[30;93H~@k[6;21H[30;93H   [7;21H[30;104H7[7;21H[?25h[?25l[30;93H~@k[7;21H[30;93H   [8;21H[30;104H8[8;21H[?25h[?25l[30;93H~@k[8;21H[30;93H   [9;21H[30;104H9[9;21H[?25h[?25l[30;93H~@k[9;21H[30;93H   [8;21H[30;104H8[8;21H[?25h[?25l[30;93H~@k[8;21H[30;93H   [7;21H[30;104H7[7;21H[?25h[?25l[30;93H~@k[7;21H[30;93H   [8;21H[30;104H8[8;21H[?25h[?25l[30;93H~@k[8;21H[30;93H   [9;21H[30;104H9[9;21H[?25h[?25l[30;93H~@k[9;21H[30;93H   [9;22H[106m([34C)[m[30;107H2[9;22H[?25h[?25l([106m([32C)[m)[30;107H3[9;23H[?25h[?25l([32C)[30;107H4[9;24H[?25h[?25l[30;93H~@k[9;24H[30;93H   [9;25H[30;107H5[9;25H[?25h[?25l[30;93H~@k[9;25H[30;93H   [9;26H[30;107H6[9;26H[?25h[?25l[30;107H7[9;27H[?25h[?25l[30;107H8[9;28H[?25h[?25l[30;107H9[9;29H[?25h[?25l[30;93H~@k[9;29H[30;93H   [9;30H[30;106H30[9;30H[?25h[?25l[30;107H1[9;31H[?25h[?25l[30;107H2[9;32H[?25h[?25l[30;93H~@k[9;32H[30;93H   [9;33H[30;107H3[9;33H[?25h[?25l[30;93H~@k[9;33H[30;93H   [9;34H[30;107H4[9;34H[?25h[?25l[30;107H5[9;35H[?25h[?25l[30;107H6[9;36H[?25h[?25l[30;107H7[9;37H[?25h[?25l[30;93H~@k[9;37H[30;93H   [9;38H[30;107H8[9;38H[?25h[?25l[30;93H~@k[9;38H[30;93H   [9;39H[30;107H9[9;39H[?25h[?25l[30;106H40[9;40H[?25h[?25l[30;93H~@k[9;40H[30;93H   [9;41H[30;107H1[9;41H[?25h[?25l[30;93H~@k[9;41H[30;93H   [9;42H[30;107H2[9;42H[?25h[?25l[30;107H3[9;43H[?25h[?25l[30;93H~@k[9;43H[30;93H   [9;44H[30;107H4[9;44H[?25h[?25l[30;93H~@k[9;44H[30;93H   [9;45H[30;107H5[9;45H[?25h[?25l[30;93H~@k[9;45H[30;93H   [9;44H[30;107H4[9;44H[?25h[?25l[30;93H~@k[9;44H[30;93H   [9;43H[30;107H3[9;43H[?25h[?25l[30;93H~@k[9;43H[30;93H   [9;42H[30;107H2[9;42H[?25h[?25l[30;93H~@k[9;42H[30;93H   [9;41H[30;107H1[9;41H[?25h[?25l[30;107H0[9;40H[?25h[?25l[30;93H~@k[9;40H[30;93H   [9;39H[30;106H39[9;39H[?25h[?25l[30;93H~@k[9;39H[30;93H   [9;38H[30;107H8[9;38H[?25h[?25l[30;93H~@k[9;38H[30;93H   [9;37H[30;107H7[9;37H[?25h[?25l[30;93H~@k[9;37H[30;93H   [9;38H[30;107H8[9;38H[?25h[?25l[30;107H9[9;39H[?25h[?25l[30;106H40[9;40H[?25h[?25l[30;93H~@k[9;40H[30;93H   [9;41H[30;107H1[9;41H[?25h[?25l[30;93H~@k[9;41H[30;93H   [9;42H[30;107H2[9;42H[?25h[?25l[30;93H~@k[9;42H[30;93H   [9;43H[30;107H3[9;43H[?25h[?25l[30;107H4[9;44H[?25h[?25l[30;93H~@k[9;44H[30;93H   [9;45H[30;107H5[9;45H[?25h[?25l[30;93H~@k[9;45H[30;93H   [9;46H[30;107H6[9;46H[?25h[?25l[30;107H7[9;47H[?25h[?25l[30;93H~@k[9;47H[30;93H   [9;48H[30;107H8[9;48H[?25h[?25l[30;107H9[9;49H[?25h[?25l[30;106H50[9;50H[?25h[?25l[30;93H~@k[9;50H[30;93H   [9;51H[30;107H1[9;51H[?25h[?25l[30;93H~@k[9;51H[30;93H   [9;52H[30;107H2[9;52H[?25h[?25l[30;107H3[9;53H[?25h[?25l[30;107H4[9;54H[?25h[?25l[30;93H~@k[9;54H[30;93H   [9;55H[30;107H5[9;55H[?25h[?25l[30;93H~@k[9;55H[30;93H   [8;35H[30;104H8,3[8;35H[?25h[?25l[30;93H~@k[8;35H[30;93H   [8;34H[30;107H4[8;34H[?25h[?25l[30;93H~@k[8;34H[30;93H   [7;34H[30;104H7[7;34H[?25h[?25l[30;93H~@k[7;34H[30;93H   [6;34H[30;104H6[6;34H[?25h[?25l[30;93H~@k[6;34H[30;93H   [6;1H[1;29r[1;1H[L[1;30r[1;9Hself.prev_error = [31m0[m[30;103H[K[30;103H35,0-1[8C40%[6;1H[?25h[?25l[30;93H~@k[6;1H[30;93H   [7;34H[30;104H6,34 [7;34H[?25h[?25l[30;93H~@k[7;34H[30;93H   [8;34H[30;104H7[8;34H[?25h[?25l[30;93H~@k[8;34H[30;93H   [7;34H[30;104H6[7;34H[?25h[?25l[30;93H~@k[7;34H[30;93H   [8;34H[30;104H7[8;34H[?25h[?25l[30;93H~@k[8;34H[30;93H   [9;34H[30;104H8[9;34H[?25h[?25l[30;93H~@k[9;34H[30;93H   [8;34H[30;104H7[8;34H[?25h[?25l[30;93H^[[8;34H[30;93H  [8;34H[30;93H^[[8;34H[30;93H  [8;34H[?25h[?25l[30;93H:[8;34H[30;93H[K[30;1H:[?2004h[?25hw[?25l[?25h[?25l[30;2H[K[30;2H[?25hq[?25l[?25h![?25l[?25h[?25l[?2004l[30;1H[K[30;1H[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ cd ,,[K[K..
]0;racecar@racecar: ~/racecar_ws/src/final_race[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race[00m$ ls
CMakeLists.txt  [0m[01;34mlaunch[0m  [01;34mmedia[0m  [01;34mmsg[0m  package.xml  params.yaml  README.md  [01;34mscripts[0m  typescript
]0;racecar@racecar: ~/racecar_ws/src/final_race[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race[00m$ cd launch
]0;racecar@racecar: ~/racecar_ws/src/final_race/launch[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/launch[00m$ s
bash: s: command not found
]0;racecar@racecar: ~/racecar_ws/src/final_race/launch[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/launch[00m$ c[Kls
[0m[01;32mline_following_deploy.launch[0m  parking_sim.launch
]0;racecar@racecar: ~/racecar_ws/src/final_race/launch[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/launch[00m$ cd ..
]0;racecar@racecar: ~/racecar_ws/src/final_race[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race[00m$ ls
CMakeLists.txt  [0m[01;34mlaunch[0m  [01;34mmedia[0m  [01;34mmsg[0m  package.xml  params.yaml  README.md  [01;34mscripts[0m  typescript
]0;racecar@racecar: ~/racecar_ws/src/final_race[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race[00m$ cd lau[K[Ksc[K[K[Kscripts/
]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ ls
[0m[01;34mcomputer_vision[0m   [01;32mcone_sim_marker.py[0m         [01;32mline_detector.py[0m           [01;32mparking_controller.py[0m
[01;32mcone_detector.py[0m  [01;32mhomography_transformer.py[0m  [01;32mparking_controller_old.py[0m  [01;34mrace_rosbags[0m
]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ cd[K[Klscd scripts/ls[Kcd ..[3Pls[1Pscd launchls[Kcd ..vim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3789C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;1H[31m    """[m
    CIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[4;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[5;13Hself.relative_cone_callback)[7;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [8;1Hdifferent for simulator vs racecar[m[9;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[10;13HAckermannDriveStamped, queue_size=[31m10[m)[11;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[12;13HParkingError, queue_size=[31m10[m)[14;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[15;9Hself.kp = [31m0.1[m[16;9Hself.kd = [31m0[m[17;9Hself.prev_error = [31m0[m[18;9Hself.relative_x = [31m0[m[19;9Hself.relative_y = [31m0[m[20;9Hself.am_moving_backwards = [36mTrue[m[23;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[24;9Hself.relative_x = msg.y_pos[25;9Hself.relative_y = msg.x_pos[26;9Hrospy.logwarn((self.relative_x, self.relative_y))[27;9H[34m# notes on coordinate system: [m[28;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[29;9Hde = self.relative_y-self.prev_error[30;103H37,34[9C19%[24;34H[?25h[?12$p[?25l[30;93H~@k[24;34H[30;93H   [24;34H[1;29r[29;1H
[1;30r[29;9Hself.prev_error = self.relative_y[30;1H[K[30;103H38,34[9C20%[24;34H[?25h[?25l[30;93H~@k[24;34H[30;93H   [24;34H[1;29r[29;1H
[1;30r[30;103H[K[30;103H39,34[9C21%[24;34H[?25h[?25l[30;93H~@k[24;34H[30;93H   [23;34H[30;104H8[23;34H[?25h[?25l[30;93H~@k[23;34H[30;93H   [22;34H[30;104H7[22;34H[?25h[?25l[30;93H~@k[22;34H[30;93H   [21;34H[30;104H6[21;34H[?25h[?25l[30;104H5,0-1[20;1H[?25h[?25l[30;104H4,8  [19;8H[?25h[?25l[30;104H3,34[18;34H[?25h[?25l[30;93H~@k[18;34H[30;93H   [17;27H[30;104H2,27[17;27H[?25h[?25l[30;93H~@k[17;27H[30;93H   [16;27H[30;104H1[16;27H[?25h[?25l[30;93H~@k[16;27H[30;93H   [15;27H[30;104H0[15;27H[?25h[?25l[30;93H~@k[15;27H[30;93H   [14;19H[30;103H29,19[14;19H[?25h[?25l[30;93H~@k[14;19H[30;93H   [13;21H[30;104H8,21[13;21H[?25h[?25l[30;93H~@k[13;21H[30;93H   [12;34H[30;104H7,34[12;34H[?25h[?25l[30;93H~@k[12;34H[30;93H   [11;1H[30;104H6,0-1[11;1H[?25h[?25l[30;93H~@k[11;1H[30;93H   [12;34H[30;104H7,34 [12;34H[?25h[?25l[30;93H~@k[12;34H[30;93H   [13;21H[30;104H8,21[13;21H[?25h[?25l[30;93H~@k[13;21H[30;93H   [14;19H[30;104H9,19[14;19H[?25h[?25l[30;93H~@k[14;19H[30;93H   [15;27H[30;103H30,27[15;27H[?25h[?25l[30;93H~@k[15;27H[30;93H   [16;27H[30;104H1[16;27H[?25h[?25l[30;93H~@k[16;27H[30;93H   [17;27H[30;104H2[17;27H[?25h[?25l[30;93H~@k[17;27H[30;93H   [18;34H[30;104H3,34[18;34H[?25h[?25l[30;93H~@k[18;34H[30;93H   [19;8H[30;104H4,8 [19;8H[?25h[?25l[30;93H~@k[19;8H[30;93H   [20;1H[30;104H5,0-1[20;1H[?25h[?25l[30;93H~@k[20;1H[30;93H   [21;34H[30;104H6,34 [21;34H[?25h[?25l[30;93H~@k[21;34H[30;93H   [22;34H[30;104H7[22;34H[?25h[?25l[30;93H~@k[22;34H[30;93H   [22;33H[30;107H3[22;33H[?25h[?25l[30;93H~@k[22;33H[30;93H   [22;32H[30;107H2[22;32H[?25h[?25l[30;93Hy[22;32H[?25h[?25l[30;94H~@k[22;32H[30;93H    [22;32H[?25h[?25l[30;93H~@k[22;32H[30;93H   [23;32H[30;104H8[23;32H[?25h[?25l[30;93H~@k[23;32H[30;93H   [24;32H[30;104H9[24;32H[?25h[?25l[30;93H~@k[24;32H[30;93H   [23;32H[30;104H8[23;32H[?25h[?25l[30;93H~@k[23;32H[30;93H   [22;32H[30;104H7[22;32H[?25h[?25l[30;93H~@k[22;32H[30;93H   [22;31H[30;107H1[22;31H[?25h[?25l[30;93Hx[22;31H[30;93H [22;31H[30;93Hdl[22;31H[30;93H  [22;31H_pos[22;35H[K[22;31H[?25h[?25l[30;93H~@k[22;31H[30;93H   [23;31H[30;104H8[23;31H[?25h[?25l[30;93H~@k[23;31H[30;93H   [22;31H[30;104H7[22;31H[?25h[?25l[30;93Hx[22;31H[30;93H [22;31H[30;93Hdl[22;31H[30;93H  [22;31Hpos[22;34H[K[22;31H[?25h[?25l[30;93Hx[22;31H[30;93H [22;31H[30;93Hdl[22;31H[30;93H  [22;31Hos[22;33H[K[22;31H[?25h[?25l[30;93Hi[22;31H[30;93H [22;31H[30;1H[1m-- INSERT --[m[30;103H[K[30;103H37,31[9C21%[22;31H[?25h[?25lxos[30;107H2[22;32H[?25h[?25l_os[30;107H3[22;33H[?25h[?25lpos[30;107H4[22;34H[?25h[?25loos[30;107H5[22;35H[?25h[?25lsos[30;107H6[22;36H[?25h[?25los[22;37H[K[30;107H5[22;35H[?25h[?25ls[22;36H[K[30;107H4[22;34H[?25h[?25l[30;104H8[23;34H[?25h[?25l[30;107H3[23;33H[?25h[?25l[30;107H2[23;32H[?25h[?25l_pos[23;35H[K[30;107H1[23;31H[?25h[?25ly_pos[30;107H2[23;32H[?25h[30;1H[K[23;31H[?25l[30;93H^[[23;31H[30;93H  [23;32H[30;103H38,31[9C21%[23;31H[?25h[?25l[30;93H:[23;31H[30;93H[K[30;1H:[?2004h[?25hw[?25l[?25hq[?25l[?25h[?25l[?2004l"parking_controller.py" 101L, 3789C written
[?2004l[?1l>[?25h[?1049l[23;0;0t]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ ls -al
total 48
drwxr-xr-x 4 racecar racecar 4096 Apr 30 18:30 [0m[01;34m.[0m
drwxr-xr-x 7 racecar racecar 4096 Apr 30 18:16 [01;34m..[0m
drwxr-xr-x 6 racecar racecar 4096 Apr 30  2023 [01;34mcomputer_vision[0m
-rwxr-xr-x 1 racecar racecar 3088 May  3  2023 [01;32mcone_detector.py[0m
-rwxr-xr-x 1 racecar racecar 3651 May  3  2023 [01;32mcone_sim_marker.py[0m
-rwxr-xr-x 1 racecar racecar 4981 May  3  2023 [01;32mhomography_transformer.py[0m
-rwxr-xr-x 1 racecar racecar 3226 May  3  2023 [01;32mline_detector.py[0m
-rwxr-xr-x 1 racecar racecar 4519 May  3  2023 [01;32mparking_controller_old.py[0m
-rwxr-xr-x 1 racecar racecar 3789 Apr 30 18:30 [01;32mparking_controller.py[0m
drwxrwxr-x 2 racecar racecar 4096 Apr 30  2023 [01;34mrace_rosbags[0m
]0;racecar@racecar: ~/racecar_ws/src/final_race/scripts[01;32mracecar@racecar[00m:[01;34m~/racecar_ws/src/final_race/scripts[00m$ ls -alvim parking_controller.pyls[Kvim parking_controller.py
[?2004h[?1049h[22;0;0t[?1h=[?2004h[1;30r[?12h[?12l[27m[23m[29m[m[H[2J[?25l[30;1H"parking_controller.py" 101L, 3789C[2;1Hâ–½[6n[2;1H  [1;1H[>c]10;?]11;?[1;5HCIRCLE_RADIUS = [31m0.9[m [34m# Radius of circle traced out when turning as fast as possible[m
    [38;5;130mdef[m [36m__init__[m(self):[3;9Hrospy.Subscriber([31m"/relative_cone"[m, ConeLocation,[4;13Hself.relative_cone_callback)[6;9HDRIVE_TOPIC = rospy.get_param([31m"~drive_topic"[m, [31m"/vesc/ackermann_cmd_mux/input/navigation"[m) [34m# set in launch file;  [7;1Hdifferent for simulator vs racecar[m[8;9Hself.drive_pub = rospy.Publisher(DRIVE_TOPIC,[9;13HAckermannDriveStamped, queue_size=[31m10[m)[10;9Hself.error_pub = rospy.Publisher([31m"/parking_error"[m,[11;13HParkingError, queue_size=[31m10[m)[13;9Hself.parking_distance = [36mfloat[m(rospy.get_param([31m"~parking_distance"[m, [31m0[m)) [34m# meters; try playing with this number![m[14;9Hself.kp = [31m0.1[m[15;9Hself.kd = [31m0[m[16;9Hself.prev_error = [31m0[m[17;9Hself.relative_x = [31m0[m[18;9Hself.relative_y = [31m0[m[19;9Hself.am_moving_backwards = [36mTrue[m[22;5H[38;5;130mdef[m [36mrelative_cone_callback[m(self, msg):[23;9Hself.relative_x = msg.x_pos[24;9Hself.relative_y = msg.y_pos[25;9Hrospy.logwarn((self.relative_x, self.relative_y))[26;9H[34m# notes on coordinate system: [m[27;9Hrelative_angle = math.atan2(self.relative_y, self.relative_x)[28;9Hde = self.relative_y-self.prev_error[29;9Hself.prev_error = self.relative_y[30;103H38,31[9C20%[24;31H[?25h[?12$p[?25l[30;93H~@k[24;31H[30;93H   [23;31H[30;104H7[23;31H[?25h[?25l[30;93H~@k[23;31H[30;93H   [22;31H[106m([9C)[m[30;104H6[22;31H[?25h[?25l[30;93H~@k[22;31H[30;93H   [21;1H[22;31H([9C)[30;104H5,0-1[21;1H[?25h[?25l[30;104H4,8  [20;8H[?25h[?25l[30;104H3,31[19;31H[?25h[?25l[30;104H2,27[18;27H[?25h[?25l[30;93H~@k[18;27H[30;93H   [17;27H[30;104H1[17;27H[?25h[?25l[30;104H0[16;27H[?25h[?25l[30;93H~@k[16;27H[30;93H   [15;19H[30;103H29,19[15;19H[?25h[?25l[30;104H8,21[14;21H[?25h[?25l[30;93H~@k[14;21H[30;93H   [13;31H[30;104H7,3[13;31H[?25h[?25l[30;93H~@k[13;31H[30;93H   [12;1H[30;104H6,0-1[12;1H[?25h[?25l[30;93H~@k[12;1H[30;93H   [11;31H[30;104H5,31 [11;31H[?25h[?25l[30;93H~@k[11;31H[30;93H   [10;31H[30;104H4[10;31H[?25h[?25l[30;93H~@k[10;31H[30;93H   [9;31H[30;104H3[9;31H[?25h